# Managing Windows Networks

## Windows Network Connection Types
- PC connects to networ trhough Network Adapter (or NIC) to switch or wireless AP

### Wired Connections
- Most based on Ethernet with RJ45 or Fiber Optic cabling.
- Adapter and switch must have same settings -> Usually set to autonegotiate link
- In Windows adapters get a name assigned: Ethernet, Ethernet2...
- To adapt settings manually: `Device Maager -> Properties -> Advanced (tab)` or `Network & Internet`

### Wireless connection
- Network status icon on notification area -> Select from list and enter required credentials
- Connect Automatically option possible
- If SSID suppresed /hidden, WLAN settings must be set manually: `Network & Internet -> Wi-Fi -> Manage known networks -> Add a new Network`
- Wifi properties of adapter on `Device Manager`. Most card support any standard available (802.11n, 802.11g, 802.b)

## IP addressing schemes
- To connect to network, logical adapter must have valid client network configuration: Adapter configured with client software and appropiate IP address allocated

### Internet Protocol addressing scheme
Ipv4. 32-bit address with 32-bit subnet mask.
Ipv6: 128-bit address. Interface address is last 64-bits. Network prefixes identify logical networks on first 64 bits.

- default gateway: IP address of the local router. Usually assigned first value available.
- Host also configured with DNS servers. DNS usually condifured on the Router in a home setting (Same values in host and router)
-  A Host can have a domain suffix to identify FQDN on the local network.

### Static vs Dynamic COnfiguration
IPs can be assigned statically or dinamically. Most hosts are configured to get IP address automatically with a DHCP server.

## Windows Client Configuration
Ip config of each network adapter on GUI via `Network & Internet` settings or `Network Connections` applet (ncpa.cpl). Default installed protocols on NEtwork Adapter:
- Client for Microsoft Networks
- File and Print sharing for Microsoft Networks
- Internet Protocol: Both IPv4 and IPv6 will be installed, adapter uses appropiate one depending on network it connects to
- Link-Layer Topology Discovery: Mapping and discovery for networks without dedicated name servers

- Default to DHCP for obtaining IP addresses
- Ip Configurations can be set via Settings App too, `Edit IP settings`

## Network Location

- Network connections governed by local OS Firewall settings by Windows Defender firewall.
- NLA - Network Location Awareness service prompts to set network type when connecting to one

Private network type:
- Trusted network (Home or office)
- PC is discoverable for print or file sharing

Public network:
- Firewall will block all traffic
- PC will be hidden from other devices
- Can't be used for file and print sharing

`Network & Internet` => Modify network type
- If Network discovery enabled: other PCs can be accessed via Network Object in File Explorer.
- UNC (Universal Naming Convention) standard to address network and host resources. Network path syntax: `\\ Host\Path` . Host is IP or FQDN and Path is shared folder's file path.

## Windows Defender Firewall Configuration

`Firewall & network protection` in Windows Defender Firewall applet.
- Block or allow incoming connections
- Configure exceptions in status page => Allow specific programs to go through Firewall

## VPN and WWAN Connection types

### VPN
- Enterprises need workers and services to connect remotely to their local networks
- VPN is an encrypted tunnel between two private networks, over a public network (WLAN)
- Remote PC becomes part of the local network, only limited to WAN link bandwidth
- `Network & Internet` to configure VPN. Some might require use of third-party software

### WWAN
Wireless Wide Area Network connection: Use cellular adapter to connect to internet via provider's network
- Bandwidth depends on adapter's and local cell tower supported techology (3G, 4G, 5G)
- WWAN adapter can be a USB or internal (Needs a SIM for GSM adapters) -> Enable connection on network status icon
- Cellular networks can charge for exceeding => Set network as `metered` and set data limit in Settings

## Proxy Settings
- Forwards packages from another service
- Can improve performance through caching
- Can improve security
- `Network & Internet` Settings to configure proxy settings

# Troubleshoot Windows Networking

## Troubleshoot IP configuration

Error states local network adater (Given not disconnected):
- Limited connectivity: DHCP server can't be contacted => Device gets APIPA or use IP specified as an alternative in IPv4 properties
- No Internet Access: IP config valid for LAN and Windows can't identify working Internet connection => Problem with router, DNS or both 

- We can See internet configuration with `ipconfig` or in `Network & Internet` settings

### ipconfig command
- `ipconfig` => IP address, subnet mask and default gateway for all network adapters
    `/all` => Detailed configuration. DHCP and DNS servers, MAC address, NetBIOS status.

It helps answer these questions:
- Does the adapter have a static address? 
    Are parameters correct (IP, subnet mask, DNS server) given the local network's IP range?
- Is adapter configured by DHCP
    Is there a valid lease?
    Are parameters correct for local network (if there is a DHCP lease)?

If DHCP lease missing or incorrect:
`ipconfig /release` => Release IP address for the adapter
`ipconfig /renew` => Force a renewal of DHCP lease
`ipconfig /displaydns` => Host and domain names recently queried. Good for troubleshooting
`ipconfig /flushdns` => Clear DNS resolver cache. If cached records are out-of-date, there will be problems accessing host and services.

### hostname command
Name configured in the local machine.

### Network reset
- Persisten problems might require a restart of application, service, or whole machine.
- Careful with restarting a server and impacting other users
- Also, reset network stack `Settings > Network & Internet -> Status`. It clears custom adapter configurations and network connections.

## Troubleshoot Local Network Connectivity

- If the problem isn't in the machine, there could be local network issues. 
- One way of testing local network is to try to connect to servers, file shares and printers, though this method isn't reliable as there could be applications failing on other machines as well.
- Low-level network testing tools are helpful to discard app issues as they only rely on `link` and `IP configuration`

### ping command
Tool to test if host can communicate with another host, local or remote

Steps to verify PC configuration and testing router connections:
1. ping loopback address `127.0.0.1` (Reserverd for testing purposes) => Verifies TCP/IP is installed and working correctly
2. ping IP address of workstation => Verify it was added correctly and check duplicate IP address
3. ping default gateway => Verify it's running and can communicate with a host on the local network
4. ping IP address of remote host => Verify we can communicate through the router

- Successful ping => `Reply from <ip_address>` message and Rount-trip time RTT in ms
Unsuccessful ping (3 possible messages):
1. `Reply from <sender_ip> Destination Unreachable`
    If in local network segment: It means sending host gets no ARP response (Address resolution Protocol). MAC address of destination host can't be located. Most likely destination host is not connected to switchor configured as non-discoverable. If not, IP misconfiguration, duplicate address, incorrect subnet mask
2. `Reply from <gateway_ip> Destination Unreachable` (default gateway - Router where our destination IP is)
    Gateway doesn't has no forwarding information for that IP address => Misconfiguration on Router or destination network.
3. `No Reply (request timed out)`
    Probe was sent to destination IP via gateway, but no response received => Destination host is down or configured to not respond.

- We can ping with DNS names or FQDN too, but it requires a DNS server available.

## Troubleshoot Remove Network Connectivity
Each router in the path counts as one hop (transfer from one router to another)

### tracert command
`tracert` command => Trace the path of a package to reach it's target.
Ex. `tracert 192.168.1.1` (Default gateway) or `tracert 8.8.8.8` Google's DNS server

- If host can't be located it will time out, but all the router hops will be logged

### pathping command
Alternative to tracert.
- Performs trace
- Also, pings each router individually a numbr of times to measure RTT and link latency more accurately.

If there's Router issue:
- Makes sure router Internet connection is ok
- Locate ISP's status page to verify no wider area network issues or DNS problems
- If not, try restarting the router

## Troubleshoot name resolution

If problem is not on basic connectivity, higher layers that can have issues:
- Security: Firewall could be blocking connections or bad proxy settings
- Name resolution: If DNS not working you can connect with IP address but not by name
- Application/OS: Software or OS that provides the service could crash.

When troubleshooting connectivity issues => *** Establish scope of the problem ***

### nslookup command
When problem is with DNS resolution. 
Syntax: `nslookup -option host dns_server` 

Host can be an IP or FQDN, Server is the dns server (default used if ommited). option specifies the particular lookup subcommand, for specific DNS record types.

Ex. `nslookup -type=mx comptia.org 8.8.8.8` 

## Troubleshoot network ports

### netstat command
To investigate open ports on the local host => To verify wether file sharing or email ports are open on a server
- `netstat` => Lists active and listening TCP ports
- `netstat -a` => Includes UDP ports in listening stage
- `netstat -b` => Shows process that has opened the port. `-o` to display the process ID instad of the name.
- `netstat -n` => Displays ports and addresses in numerical format.
- `-e and -s` => Report Ethernet and protocol statistics respectively.

Ports and services open without authorization pose a high security risk. Authorized services must be monitored and patched against vulnerabilities.

# Configure Windows Security Settings

# T SORO notes

# Commands
`tracert` => Show path internet traffic takes to get to end destination (Trace Route)
`ipconfig` / `ifconfig` =>
`ping`
`nslookup` => Ip address associated to a domain
`netstat` =. Report status and connections
`gpupdate` -> To force group policy update
