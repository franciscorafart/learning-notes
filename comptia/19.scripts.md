# Scriptin Tools

# Remote Access Technologies

- Desktop and command line tools to control computer remotely

## Remote Desktop tools

- Graphical terminal server that accepts connections from clients
- Often used for working from home or for technician troubleshooting
Considerations:
- Remote access with least privilege principle
- Encrypted connection to avoid spoofing and digital certificate to avoid evil-twin attacks.
- Server software must be free from vulnerabilities

### Remote Desktop Protocol (mstsc.exe)
- Windows remote desktop control
- Use IP or server's FQDN to connect
- Use domain or local account as credentials for remote host `Domain\Username` or `\ Username` or `Host\Username`
- Connection always encrypted
- One person signed in at a time
- Client software for Linux, Mac, and Windows

### Virtual Network Computing (VNC)
- Screen share is an alternative for Mac => Based on Virtual Network Computing  
- VNC: Remote access tool and protocol
    - Similar functionality as RDP
    - Encrypted in MacOS (Not on all versions of VNC)
    - TCP 5900

## RDP Servers and Security settings

- Remote Server Desktop must be enabled (disabled by default) `Settings > Remote Desktop`
- Users allowed to Remote desktop from local accounts db or from machine domain.
- Advanced Settings => Define if older accounts allowed to connect or require clients to support Network Level Authentication (NLA)
    - NLA protects against DoS attacks, configuring desktop and allocating resources AFTER user authenticates.
- Compromised Client device makes the credentials highly vulnerable
    - RDP Restricted Admin (RDPRA) Mode and Remote Credential Guard are means of mitigating this risk
- Runs of port 3389 by default
- Not included on Windows Home Editions
- XRDP is open source solution => To run RDP on Linux for example

## Microsoft Remote Assistance (MSRA - msra.exe)
- Allows to ask help to technician or coworker via invitation file protected by passcode
- Open file to connect over RDP
- Chat feature and control of desktop request
- Assigns port dinamically -> Hard to configure Firewall to allow connection
- Windows 10 introduces Quick Assit as alternative to MSRA => Works over https and helper must be signed with Microsoft account

## Secure Shell (SSH)
- CLI remote access protocol
- Port 22
- Encrypted
- Open source ssh products
- SSH server configured with public/private key pair, identified by host key fingerprint
- Client uses host fingerprint to verify they're connecting to trusted server
- Mapping of host names and SSH server keys kept manaully or software product for SSH key management
- Server's key pair sets encrypted channel by which Client can provide authentication credentials
2 Methods of authentications:
1. Password: Client provides user name and password
2. Public key authentication: 
    - Server has list of public keys of authorized user accounts.
    - Client requests auth with one of those keys and Server generates challenge with it => Client must use private key to decrypt the challenge and complete authentication.

## Desktop Management and Remote Monitoring Tools

Remote managment an monitor tools necessary for efficient administration of network devices => Technician can't phisically visit all devices.

2 classes of enterprise monitoring/remote access tools:

1. RMM (Remote monitoring and Management)
    - Designed for managed service providers (MSPs)
    - MSP is outsourcing company for IT support

2. UEM (Desktop management unified endpoint management)
    - Access control and authorization for a single organization

They offer mix of follwing functionalities:

1. Locally installed agents to report status, log, inventory, and ticket/help desk integration
2. Agents taht perform EDR Endpoint Detection and Response Security scans => Early threat detection
3. Automated "push: of patches, upgrades, apps, scripts, etc
4. Remote network boot capabilities or Wake on LAN (WOL) and remote system firmware update
5. Access control for hosts that don't meet OS versions
6. Live chat and Remote Desktop / Shell connections to Host

- Software agent depends on OS to be running
- Management suite can take advantage of hardware controller => Out-of-Band update or Power machine remotely.

## Other Remote Access Tools

- There are cheaper alternatives for Sofware and Protocols when managing a limited amount of PCs

### Screen sharing software
- Alternatives to Screen Sharing tlike MSRA/Quick assist
- Ex. Team Viewer, LogMein => Work over https
- Can be installed locally or be executed non-persistenly

### Video Conferencing Software
- Video conferencing tools include screen-share client (Zoom, Teams, Slack)
- Share willhave privilege of signed in user
- Useful for demoing tasks and reproducing support issues

### File Transfer Software
- OS Vendors have different solution for file sharing to avoid setting up file sharing servers
1. Airdrop.
    - iOS
    - WiFi and Bluetooth
    - Encrypted
2. Nearby Sharing
    - Microsoft's version of AirDrop
    - Introduced in Windows 10
3. Nearby share
    - Bluetooth sharing for Android devices

- This products are generally secure bu can be misused => Accepting connections from any source a danger

### Virtual Private Networks
- SSH and RDP => Connection to single host over a network
- VPN => tunneled link between local PC and remote LAN
- Both can be combined for extra security => VPN and Remote Desktop to avoid opening reote desktop ports on Firewall (Important)

# Backup and Recovery

- Backup to mitigate effects of disaster or malware
- Backup dificult to implement because it's a routine procedure that needs to cope with uncommon scenarios => Difficult to plan
- Backups can also fail

Backup strategies
Why are we backing up? Restore system, versioning?
What do we need to backup? File, app?

- RTO: Recovery Time Objective
- RPO: Recovery Point Objective

- 321 Rule of backup
    - Primary and 2 copies.
    - One backup off site

## Backup Operations
- Storing of critical data for safekeeping
- Data Recovery: Task that enables to restore user access to lost or currupt data via backup

- Most orgs implement structured backup shceme that included backup schedule and specify which files to backup
- Bad practice to store data locally if connected to a Network => Move it to a server where it can be backed up safely
- Personal backups necessary when no central file server available
- Windows user backup in `File History` through `Settings > Update & Security > Backup` 
    - Configure Local drive or network flder as target for storage.
    - Select which files to backup or not
    - Previos Version tab or File history applet to restore multiple files
- Backup ad Restore Center (Windows)
    - Alternative backup manager
    - It can make images of whole OS instead of just data files

- Mac: Time Machine

## Backup Methods
- Policies for backup frequency and methods should be established in policies
- Adequate coverage while minimizing backup storage
2 main factors
1. Frequency
    - Period between backup jobs
    - Determined by how much loss can be tolerated
2. Retention
    - Period a backup is kept for
    - Sort term -> Version control and malware revocery
    - Regulations might require data not be kept for more thatn a certain time

### Backup chains
- Different backub jobs in a Backup Chain: Sequence of jobs(Full backup - Incremental - differential) to implement media rotation scheme
    1. Full only
        - Backup job produces a file that contains all data from source
        - Highers storage and time requirements, least recovery complexity
        - Single job (Full backup)
    2. Full with incremental
        - chain starts with full backup and then runs incremental jobs to select new and modified files
        - Lowest time and storage requirement, most recovery complexity
        - Multiple jobs
    3. Full with differential
        - Chain starts with full abckup
        - Runs differential jobs that select new and modified files since original full ob
        - Moderate time and storage requirements, slighly less recovery complexity than incremental
        - Max of 2 jobs (Full and differential)

- Windows uses archive attribute to determine backup status, Linx doesn't support it, but uses a timestamp that determines whenfile was changed

### Synthetic full backup
- Option for full backup with lower datatransfer requirements
- Not generated directly from original data, bit assembled from previous backup jobs

1. Chain starts with initial full backup, and does incremental ones after
2. Next full backup => software makes one more incremental backup and synthesizes a new full backup from previous full and incremental backups

## Backup Media Requirements
- backup rotation scheme => Allows some media to be reused once retention period over
Rotation schemes:
1. GFS - Grandfather-Father-Son
    - Labels backup tapes by generations
        - Sons: Most recent data, shortest retention period (week, days)
        - Grandfather: Oldest data longest retention period (months, year(s))
    Implementation example:
        1. Full backup each week to Father tape (weekly)
        2. Incremental backups made on Son tape (each day or every x amount of minutes)
        3. Full backup performed at the end if the month on Grandfather tape
        4. Father tapes reused for next month on same order
    - Father tapes can use synthetic backuos

### On Site vs. Off Site Storage
On site: Production and backup on same physical location => Risk in case of disaster
- Media rotation schee such as GFS => some backup media is taken off site, and some others kept off site (Grandfather) until backup routine happens
- Cloud backup also has risks

### Online vs Offline backups

- Online backup
    - Instantly available to perform backup or restore operation
- Offline 
    - backup must be physically connected to perform recovery
    - Better security (Be able to recover from crypto ransomware for example)

### 3-2-1 Backup rule
- 3 copies of data, including production copy
- Two media types
- One copy on site, one copy off site

## Bakup testing and Recovery Best Practices

- Test backup scheme to make sure it's reliable => Test recovery into virtual machine or into test directory
- Configure backup software to verify after it writes => Hashing to verify job is valid copy of source data
    - Verify media integrity regulary by running `chkdsk`
- Verify backups contain all required files
- ReTest recovery procedures every time there's a change to backup schedule or requirements => Do it periodically

# Data Handling Best Practices
